<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>The Water Footprint of Foods</title>
  <link href="https://fonts.googleapis.com/css?family=Lato:300,400,700,900|Raleway:300,400,700,900" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
  <!-- <script type="text/javascript" src="https://d3js.org/d3.v3.min.js"></script>
  <script src="https://labratrevenge.com/d3-tip/javascripts/d3.tip.v0.6.3.js"></script> . -->
  <script src="d3.v3.js"></script>
  <script src="d3tip.js"></script>
</head>
<body>

<div class="title">The Water Footprint of Foods</div>
<div class="by-line">By <span class="author">Brandon Chai</span><span class="date">November 18, 2016</span></div>
<!-- <div class="meta">For <span class="professor">Suresh Lodha<span> <span class="class">CMPS 165</span>  <span class="quarter">Fall 2016</span></div> -->
<div class="lead">Are you aware of how much water the foods you eat consume? Meat and diary foods require substantially more water to produce than vegetables and fruits.</div>

<div class="tab">
  <span class="tab__item tab__item--left inactive">Food groups</span>
  <span class="tab__item tab__item--right active">All foods</span>
</div>

<!-- <div class="sources" style="position: relative; bottom: -1000px; text-align: center; width: 500px; margin: 0 auto;"> -->
<div class="sources">
  <div class="separator"></div>
  <div class="sources__links" style="display: flex; justify-content: center;">
    <div class="sources__section sources__files" style="width:100px;">
      <div class="sources__title">Files</div>
      <div>index.html</div>
      <div>style.css</div>
      <div>data.csv</div>
    </div>
    <div class="sources__section sources__data">
      <div class="sources__title">Data Sources</div>
      <div class="source__item">
        <div class="source__institution">United State Department of Agriculture</div>
        <a href="https://www.ers.usda.gov/data-products/food-availability-per-capita-data-system/">Food Availability (Per Capita) Data System</a>
      </div>
      <div class="source__item">
        <div class="source__institution">Mekonnen-Hoekstra, 2011</div>
        <a href="http://waterfootprint.org/media/downloads/Mekonnen-Hoekstra-2011-WaterFootprintCrops.pdf">The green, blue and grey water footprint of crops and derived crop
products</a>
      </div>
      <div class="source__item">
        <div class="source__institution">Water Footprint Network</div>
        <a href="http://waterfootprint.org/en/resources/water-footprint-statistics/#CP1">Water footprint statistics (WaterStat)</a>
      </div>
    </div>
    <div class="sources__section sources__code">
      <div class="sources__title">Code &amp; Visualization Sources</div>
      <div class="source__item">
        <div class="source__institution">Justin Palmer</div>
        <a href="http://bl.ocks.org/Caged/6476579">D3 Tool tip reference</a>
      </div>
      <div class="source__item">
        <div class="source__institution">Los Angeles Times</div>
        <a href="http://graphics.latimes.com/food-water-footprint/">462 gallons of water were used to make this plate</a>
      </div>
    </div>
  </dir>

</div>

<script>

  var foods = [
                  //gal/cal   gal/lb  lbs 
                  [ 55,       20,     155,    "Orange",          "fruit"       ],
                  [ 480,      90,     162,    "Beef",            "meat"        ],
                  [ 250,      50,     617,    "Broccoli",        "vegetable"   ],
                  [ 100,      33,     157,    "Quinoa",          "grain"       ],
                  [ 330,      95,     477,    "Chicken",         "meat"        ],
                  [ 410,      12,     327,    "Milk",            "dairy"       ],
                  [ 275,      44,     1517,   "Pork",            "meat"        ],
                  [ 215,      24,     317,    "Salmon",          "fish"        ],
                  [ 142,      14,     527,    "Almond",          "nut"         ],
                  [ 301,      54,     217,    "Papaya",          "fruit"       ]
                ];

  var foodgroups = [
                  //gal/cal   gal/lb  lbs 
                  [ 0.608987199,      127.0066732,  135.88,   "Fruits",              "fruit"        ],
                  [ 0.39069293,      42.531692,     185.7,    "Vegetables",          "vegetable"        ],
                  [ 1.05565715,      1197.095418,     15,    "Nuts",                "fruit"       ],
                  [ 0.2367249,       312.251304,     17,    "Oil Crops",           "vegetable"   ],
                  [ 0.2012854,      26.020942,     150,   "Sugar Crops",         "vegetable"       ],
                  [ 0.3460770,      535.60873,     14,    "Beans and Legumes",      "vegetable"      ],
                  [ 0.1492307,       217.149384,     147,    "Grains",             "grain"       ],
                  [ 0.4351966,       215.168094,     5.4,        "Farmed Fish",          "meat"            ],
                  [ 2.96684955,      2036.10569,     91.2,       "Red Meat",      "meat"               ],
                  [ 0.8746102,       571.27195,      56.4,    "Poultry",                   "meat"              ]
                ];

  var margin = {left  : 180, 
                right : 250, 
                top   : 50, 
                bottom: 150 },

      width  = 1200 - margin.left - margin.right,

      height = 700 - margin.top  - margin.bottom;

  d3.csv("data.csv", function(error, data) {
    dataset = data.map(function(d) { return [ +d["gal/calorie"], +d["gal/lb"], +d["lb/capita"], d["name"], d["group"] ]; });
    console.log(JSON.stringify(dataset))
  

  var xScale = d3.scale.linear()
                 .domain([0, d3.max(dataset, function(d) {return d[0]; })]) 
                 .range([0, width]);

  var yScale = d3.scale.linear()
                 .domain([0, d3.max(dataset, function(d) {return d[1]; })]) 
                 .range([height, 0]);

  var rScale = d3.scale.linear()
                 .domain([0, d3.max(dataset, function(d) {return d[2]; })]) 
                 .range([0, 1500])

  var xAxis  = d3.svg.axis()
                 .scale(xScale)
                 .orient("bottom")
                 .ticks(5)
                 .tickSize(1)
                 .tickPadding(15);

  var yAxis  = d3.svg.axis()
                 .scale(yScale)
                 .orient("left")
                 .ticks(5)
                 .tickSize(1)
                 .tickPadding(15);

  var round = function(num) {
    return Math.round(num * 100) / 100
  }

  var tip = d3.tip()
              .attr('class', 'd3-tip')
              .offset([-10, 0])
              .html(function(d) {
                return '<div class="tooltip-title">' + d[3] + "</div>" + 
                       '<img class="tooltip-img" width="50" src="http://pngimg.com/upload/small/apple_PNG12436.png">' +
                       '<div class="tooltip-metric"><span class="tooltip-metric__name">Gallons per calorie</span><span class="tooltip-metric__value">' + round(d[0]) +'</span></div>' +
                       '<div class="tooltip-metric"><span class="tooltip-metric__name">Gallons per pound</span><span class="tooltip-metric__value">' + round(d[1]) +'</span></div>' +
                       '<div class="tooltip-metric"><span class="tooltip-metric__name">Pounds per person</span><span class="tooltip-metric__value">' + round(d[2]) +'</span></div>' +
                       '<div class="triangle"></div>';
              })

  var svg    = d3.select("body")
                 .append("svg")
                 .attr("width", width + margin.left + margin.right)
                 .attr("height", height + margin.top + margin.bottom)
                 .append("g")
                 .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

              svg.call(tip);

              svg.selectAll(".datapoint")
                 .data(dataset)
                 .enter()
                 .append("circle")
                 .attr("class", function(d) {
                  return "datapoint " + d[4];
                 })
                 .attr("id", function(d) {
                  return d[4];
                 })
                 .style("fill", function(d) {
                    switch(d[4]) {
                      case "meat":
                        return "E99399";
                        break;
                      case "fruit":
                        return "B6CFE8";
                        break;
                      case "vegetable":
                        return "#B5DDC3";
                        break;
                      case "fish":
                        return "#EAE9A1";
                        break;
                      case "grain":
                        return "#C3A1EA";
                        break;
                      case "nut":
                        return "#E87F7F";
                        break;
                      case "dairy":
                        return "#92BBE8";
                        break;
                      default:
                        return "#ccc";
                    }
                 }) 
                 .attr("cx", function(d) {
                    return xScale(d[0]);
                 })
                 .attr("cy", function(d) {
                    return yScale(d[1]);
                 })
                 .attr("r", function(d) {
                    return Math.sqrt(rScale(d[2]));
                 })
                 .attr("height", function(d) { return height - yScale(d[1]); })
                 .attr("opacity", 0.7)
                 .on('mouseover', tip.show)
                 .on('mouseout', tip.hide);

              svg.select(".x.axis")
                  // .transition()
                  // .duration(1000)
                  .call(xAxis);

              // Update Y Axis
              svg.select(".y.axis")
                  // .transition()
                  // .duration(100)
                  .call(yAxis);

              svg.append("g")
                 .attr("class", "x axis")
                 .attr("transform", "translate(0," + height + ")")
                 .call(xAxis)
                 .append("text")
                 .attr("class", "label")
                 .attr("y", 60)
                 .attr("x", width/2 + 40)
                 .style("text-anchor", "middle")
                 .attr("font-size", "15px")
                 .style("fill", "#333")
                 .style("font-family", "Lato")
                 .style("font-weight", "900")
                 .text("Gallons of water consumed");

              svg.append("g")
                 .attr("class", "x axis")
                 .attr("transform", "translate(0," + height + ")")
                 .call(xAxis)
                 .append("text")
                 .attr("class", "label")
                 .attr("y", 60)
                 .attr("x", width/2 + 40)
                 .attr("dy", "1.3em")
                 .style("text-anchor", "middle")
                 .attr("font-size", "15px")
                 .style("fill", "#333")
                 .style("font-family", "Lato")
                 .style("font-weight", "900")
                 .text("per calorie");

              svg.append("g")
                 .attr("class", "y axis")
                 .call(yAxis)
                 .append("text")
                 .attr("class", "label")
                 .attr("y", 250)
                 .attr("x", -180)
                 .attr("dy", ".7em")
                 .style("max-width", "50px")
                 .style("text-anchor", "center")
                 .attr("font-size", "15px")
                 .style("fill", "#333")
                 .style("font-family", "Lato")
                 .style("font-weight", "900")
                 .text("Gallons of water");

              svg.append("g")
                 .attr("class", "y axis")
                 .call(yAxis)
                 .append("text")
                 .attr("class", "label")
                 .attr("y", 250)
                 .attr("x", -180)
                 .attr("dy", "2em")
                 .style("max-width", "50px")
                 .style("text-anchor", "center")
                 .attr("font-size", "15px")
                 .style("fill", "#333")
                 .style("font-family", "Lato")
                 .style("font-weight", "900")
                 .text("consumed per lb");

               svg.append("g")
                 .attr("class", "y axis")
                 .call(yAxis)
                 .append("text")
                 .attr("class", "label")
                 .attr("y", 365)
                 .attr("x", 50)
                 .attr("dy", "2em")
                 .style("max-width", "50px")
                 .style("text-anchor", "center")
                 .attr("font-size", "15px")
                 .style("fill", "#777")
                 .style("font-family", "Lato")
                 .style("font-weight", "100")
                 .style("cursor", "pointer")
                 .text("Most water efficient");

              // svg.append("g")
              //    .append("text")
              //    .attr("class", "label")
              //    .attr("y", 250)
              //    .attr("x", -157)
              //    .attr("dy", "3.3em")
              //    .style("text-anchor", "center")
              //    .attr("font-size", "15px")
              //    .style("fill", "#333")
              //    .style("font-family", "Lato")
              //    .style("font-weight", "900")
              //    .text("per pound");

              svg.append("g")
                 .attr("class", "y axis")
                 .style("stroke-dasharray", ("3, 3"))
                 .call(yAxis);

              svg.append("circle")
                 .attr("r", 13)
                 .attr("cx", width+70)
                 .attr("cy", height-230)
                 .style("fill", "#fff")
                 .style("stroke", "#aaa")

              svg.append("text")
                 .attr("class", "legend-scale")
                 .attr("x", width +80)
                 .attr("y", height-246)
                 .attr("dx", "1em")
                 .attr("dy", "5px")
                 .style("text-anchor", "start")
                 .style("font-family", "Lato")
                 .style("fill", "#333")
                 .attr("font-size", "14px")
                 .text("Radius reflects per capita");

              svg.append("text")
                 .attr("class", "legend-scale")
                 .attr("x", width +80)
                 .attr("y", height-246)
                 .attr("dx", "1em")
                 .attr("dy", "21px")
                 .style("text-anchor", "start")
                 .style("font-family", "Lato")
                 .style("fill", "#333")
                 .attr("font-size", "14px")
                 .text("consumption in pounds");

              svg.append("text")
                 .attr("class", "legend-scale")
                 .attr("x", width +80)
                 .attr("y", height-246)
                 .attr("dx", "1em")
                 .attr("dy", "37px")
                 .style("text-anchor", "start")
                 .style("font-family", "Lato")
                 .style("fill", "#333")
                 .attr("font-size", "14px")
                 .text("anually in the U.S");

              svg.append("text")
                 .attr("class", "legend-scale")
                 .attr("x", width +50)
                 .attr("y", height-75)
                 .attr("dx", "4px")
                 .attr("dy", "5px")
                 .style("text-anchor", "start")
                 .style("font-family", "Lato")
                 .style("fill", "#ccc")
                 .attr("font-size", "14px")
                 .attr("font-weight", "100")
                 .text("Click categories to toggle");

              svg.append("text")
                 .attr("class", "legend-scale")
                 .attr("x", width-70)
                 .attr("y", 95)
                 .attr("dx", "4px")
                 .attr("dy", "5px")
                 .style("text-anchor", "start")
                 .style("font-family", "Lato")
                 .style("fill", "#777")
                 .attr("font-size", "14px")
                 .attr("font-weight", "100")
                 .text("Least water efficient");

              // svg.append("circle")
              //    .attr("r", 6.5)
              //    .attr("cx", width+70)
              //    .attr("cy", height-170)
              //    .style("fill", "#bbb")
              //    .attr("class", "legend")
              //    .attr("id", "dairy-label__circle")
              //    .style("fill", "#92BBE8")
              //    .on("click", function(){
              //       // Determine if current line is visible
              //       var active   = dairy.active ? false : true ,
              //         newOpacity = active ? 0.1 : 0.7,
              //         newTextColor   = active ? "#333" : "#92BBE8";
              //         newCircleColor   = active ? "#aaa" : "#92BBE8";
              //       // Hide or show the elements
              //       d3.selectAll(".dairy").style("opacity", newOpacity);
              //       d3.select("#dairy-label").style("fill", newTextColor);
              //       d3.select("#dairy-label__circle").style("fill", newCircleColor);
              //       // Update whether or not the elements are active
              //       dairy.active = active;
              //     })

              // svg.append("text")
              //    .attr("class", "legend")
              //    .attr("id", "dairy-label")
              //    .attr("x", width +70)
              //    .attr("y", height-170)
              //    .attr("dx", "1em")
              //    .attr("dy", "5px")
              //    .style("text-anchor", "start")
              //    .style("font-family", "Lato")
              //    .style("fill", "#92BBE8")
              //    .attr("font-size", "14px")
              //    .text("Dairy")
              //    .on("click", function(){
              //       // Determine if current line is visible
              //       var active   = dairy.active ? false : true ,
              //         newOpacity = active ? 0.1 : 0.7,
              //         newTextColor   = active ? "#333" : "#92BBE8";
              //         newCircleColor   = active ? "#aaa" : "#92BBE8";
              //       // Hide or show the elements
              //       d3.selectAll(".dairy").style("opacity", newOpacity);
              //       d3.select("#dairy-label").style("fill", newTextColor);
              //       d3.select("#dairy-label__circle").style("fill", newCircleColor);
              //       // Update whether or not the elements are active
              //       dairy.active = active;
              //    })

              svg.append("circle")
                 .attr("r", 6.5)
                 .attr("cx", width+70)
                 .attr("cy", height-170)
                 .attr("id", "meat-label__circle")
                 .attr("class", "legend")
                 .style("fill", "#E99399")
                 .on("click", function(){
                    // Determine if current line is visible
                    var active   = meat.active ? false : true ,
                      newOpacity = active ? 0.1 : 0.7,
                      newTextColor   = active ? "#888" : "#E99399";
                      newCircleColor   = active ? "#aaa" : "#E99399";
                    // Hide or show the elements
                    d3.selectAll(".meat").style("opacity", newOpacity);
                    d3.select("#meat-label").style("fill", newTextColor);
                    d3.select("#meat-label__circle").style("fill", newCircleColor);
                    // Update whether or not the elements are active
                    meat.active = active;
                  })



              svg.append("text")
                 .attr("class", "legend")
                 .attr("id", "meat-label")
                 .attr("x", width +70)
                 .attr("y", height-170)
                 .attr("dx", "1em")
                 .attr("dy", "5px")
                 .style("text-anchor", "start")
                 .style("font-family", "Lato")
                 .style("fill", "E99399")
                 .attr("font-size", "14px")
                 .text("Meat and poultry")
                 .on("click", function(){
                    // Determine if current line is visible
                    var active   = meat.active ? false : true ,
                      newOpacity = active ? 0.1 : 0.7,
                      newTextColor   = active ? "#888" : "#E99399";
                      newCircleColor   = active ? "#aaa" : "#E99399";
                    // Hide or show the elements
                    d3.selectAll(".meat").style("opacity", newOpacity);
                    d3.select("#meat-label").style("fill", newTextColor);
                    d3.select("#meat-label__circle").style("fill", newCircleColor);
                    // Update whether or not the elements are active
                    meat.active = active;
                  })

              // svg.append("circle")
              //    .attr("r", 6.5)
              //    .attr("cx", width+70)
              //    .attr("cy", height-130)
              //    .style("fill", "#999")
              //    .attr("id", "fish-label__circle")
              //    .attr("class", "legend")
              //    .style("fill", "#EAE9A1")
              //    .on("click", function(){
              //       // Determine if current line is visible
              //       var active   = fish.active ? false : true ,
              //         newOpacity = active ? 0.1 : 0.7,
              //         newTextColor   = active ? "#333" : "#EAE9A1";
              //         newCircleColor   = active ? "#aaa" : "#EAE9A1";
              //       // Hide or show the elements
              //       d3.selectAll(".fish").style("opacity", newOpacity);
              //       d3.select("#fish-label").style("fill", newTextColor);
              //       d3.select("#fish-label__circle").style("fill", newCircleColor);
              //       // Update whether or not the elements are active
              //       fish.active = active;
              //    })

              // svg.append("text")
              //    .attr("class", "legend")
              //    .attr("id", "fish-label")
              //    .attr("x", width +70)
              //    .attr("y", height-130)
              //    .attr("dx", "1em")
              //    .attr("dy", "5px")
              //    .style("text-anchor", "start")
              //    .style("font-family", "Lato")
              //    .style("fill", "#EAE9A1")
              //    .attr("font-size", "14px")
              //    .text("Fish")
              //    .on("click", function(){
              //       // Determine if current line is visible
              //       var active   = fish.active ? false : true ,
              //         newOpacity = active ? 0.1 : 0.7,
              //         newTextColor   = active ? "#333" : "#EAE9A1";
              //         newCircleColor   = active ? "#aaa" : "#EAE9A1";
              //       // Hide or show the elements
              //       d3.selectAll(".fish").style("opacity", newOpacity);
              //       d3.select("#fish-label").style("fill", newTextColor);
              //       d3.select("#fish-label__circle").style("fill", newCircleColor);
              //       // Update whether or not the elements are active
              //       fish.active = active;
              //    })

              svg.append("circle")
                 .attr("r", 6.5)
                 .attr("cx", width+70)
                 .attr("cy", height-150)
                 .style("fill", "#888")
                 .attr("id", "grain-label__circle")
                 .attr("class", "legend")
                 .style("fill", "#C3A1EA")
                 .on("click", function(){
                    // Determine if current line is visible
                    var active   = grain.active ? false : true ,
                      newOpacity = active ? 0.1 : 0.7,
                      newTextColor   = active ? "#888" : "#C3A1EA";
                      newCircleColor   = active ? "#bbb" : "#C3A1EA";
                    // Hide or show the elements
                    d3.selectAll(".grain").style("opacity", newOpacity);
                    d3.select("#grain-label").style("fill", newTextColor);
                    d3.select("#grain-label__circle").style("fill", newCircleColor);
                    // Update whether or not the elements are active
                    grain.active = active;
                 })

              svg.append("text")
                 .attr("class", "legend")
                 .attr("id", "grain-label")
                 .attr("x", width +70)
                 .attr("y", height-150)
                 .attr("dx", "1em")
                 .attr("dy", "5px")
                 .style("text-anchor", "start")
                 .style("font-family", "Lato")
                 .style("fill", "#C3A1EA")
                 .attr("font-size", "14px")
                 .text("Grains")
                 .on("click", function(){
                    // Determine if current line is visible
                    var active   = grain.active ? false : true ,
                      newOpacity = active ? 0.1 : 0.7,
                      newTextColor   = active ? "#888" : "#C3A1EA";
                      newCircleColor   = active ? "#bbb" : "#C3A1EA";
                    // Hide or show the elements
                    d3.selectAll(".grain").style("opacity", newOpacity);
                    d3.select("#grain-label").style("fill", newTextColor);
                    d3.select("#grain-label__circle").style("fill", newCircleColor);
                    // Update whether or not the elements are active
                    grain.active = active;
                 })

              svg.append("circle")
                 .attr("r", 6.5)
                 .attr("cx", width+70)
                 .attr("cy", height-130)
                 .attr("id", "vegetable-label__circle")
                 .attr("class", "legend")
                 .style("fill", "#B5DDC3")
                 .on("click", function(){
                    // Determine if current line is visible
                    var active   = vegetable.active ? false : true ,
                      newOpacity = active ? 0.1 : 0.7,
                      newTextColor   = active ? "#888" : "#B5DDC3";
                      newCircleColor   = active ? "#ccc" : "#B5DDC3";
                    // Hide or show the elements
                    d3.selectAll(".vegetable").style("opacity", newOpacity);
                    d3.select("#vegetable-label").style("fill", newTextColor);
                    d3.select("#vegetable-label__circle").style("fill", newCircleColor);
                    // Update whether or not the elements are active
                    vegetable.active = active;
                 })

              svg.append("text")
                 .attr("class", "legend")
                 .attr("id", "vegetable-label")
                 .attr("x", width +70)
                 .attr("y", height-130)
                 .attr("dx", "1em")
                 .attr("dy", "5px")
                 .style("text-anchor", "start")
                 .style("font-family", "Lato")
                 .style("fill", "#B5DDC3")
                 .attr("font-size", "14px")
                 .text("Vegetables")
                 .on("click", function(){
                    // Determine if current line is visible
                    var active   = vegetable.active ? false : true ,
                      newOpacity = active ? 0.1 : 0.7,
                      newTextColor   = active ? "#888" : "#B5DDC3";
                      newCircleColor   = active ? "#ccc" : "#B5DDC3";
                    // Hide or show the elements
                    d3.selectAll(".vegetable").style("opacity", newOpacity);
                    d3.select("#vegetable-label").style("fill", newTextColor);
                    d3.select("#vegetable-label__circle").style("fill", newCircleColor);
                    // Update whether or not the elements are active
                    vegetable.active = active;
                 })

              svg.append("circle")
                 .attr("id", "fruit-label__circle")
                 .attr("r", 6.5)
                 .attr("cx", width+70)
                 .attr("cy", height-110)
                 .style("fill", "B6CFE8")
                 .attr("class", "legend")
                 .on("click", function(){
                    // Determine if current line is visible
                    var active   = fruit.active ? false : true ,
                      newOpacity = active ? 0.1 : 0.7,
                      newTextColor   = active ? "#888" : "B6CFE8";
                      newCircleColor   = active ? "#ddd" : "B6CFE8";
                    // Hide or show the elements
                    d3.selectAll(".fruit").style("opacity", newOpacity);
                    d3.select("#fruit-label").style("fill", newTextColor);
                    d3.select("#fruit-label__circle").style("fill", newCircleColor);
                    // Update whether or not the elements are active
                    fruit.active = active;
                  });

              svg.append("text")
                 .attr("class", "legend")
                 .attr("id", "fruit-label")
                 .attr("x", width +70)
                 .attr("y", height-110)
                 .attr("dx", "1em")
                 .attr("dy", "5px")
                 .style("text-anchor", "start")
                 .style("font-family", "Lato")
                 .style("fill", "B6CFE8")
                 .attr("font-size", "14px")
                 .text("Fruits")
                 .on("click", function(){
                    // Determine if current line is visible
                    var active   = fruit.active ? false : true ,
                      newOpacity = active ? 0.1 : 0.7,
                      newTextColor   = active ? "#888" : "B6CFE8";
                      newCircleColor   = active ? "#ddd" : "B6CFE8";
                    // Hide or show the elements
                    d3.selectAll(".fruit").style("opacity", newOpacity);
                    d3.select("#fruit-label").style("fill", newTextColor);
                    d3.select("#fruit-label__circle").style("fill", newCircleColor);
                    // Update whether or not the elements are active
                    fruit.active = active;
                  });

              // svg.append("circle")
              //    .attr("r", 6.5)
              //    .attr("cx", width+70)
              //    .attr("cy", height-50)
              //    .attr("id", "nut-label__circle")
              //    .attr("class", "legend")
              //    .style("fill", "#E87F7F")
              //    .on("click", function(){
              //       // Determine if current line is visible
              //       var active   = nut.active ? false : true ,
              //         newOpacity = active ? 0.1 : 0.7,
              //         newTextColor   = active ? "#333" : "#E87F7F";
              //         newCircleColor   = active ? "#666" : "#E87F7F";
              //       // Hide or show the elements
              //       d3.selectAll(".nut").style("opacity", newOpacity);
              //       d3.select("#nut-label").style("fill", newTextColor);
              //       d3.select("#nut-label__circle").style("fill", newCircleColor);
              //       // Update whether or not the elements are active
              //       nut.active = active;
              //     });

              // svg.append("text")
              //    .attr("class", "legend")
              //    .attr("id", "nut-label")
              //    .attr("x", width +70)
              //    .attr("y", height-50)
              //    .attr("dx", "1em")
              //    .attr("dy", "5px")
              //    .style("text-anchor", "start")
              //    .style("font-family", "Lato")
              //    .style("fill", "#E87F7F")
              //    .attr("font-size", "14px")
              //    .text("Nuts")
              //    .on("click", function(){
              //       // Determine if current line is visible
              //       var active   = nut.active ? false : true ,
              //         newOpacity = active ? 0.1 : 0.7,
              //         newTextColor   = active ? "#333" : "#E87F7F";
              //         newCircleColor   = active ? "#666" : "#E87F7F";
              //       // Hide or show the elements
              //       d3.selectAll(".nut").style("opacity", newOpacity);
              //       d3.select("#nut-label").style("fill", newTextColor);
              //       d3.select("#nut-label__circle").style("fill", newCircleColor);
              //       // Update whether or not the elements are active
              //       nut.active = active;
              //     });


        d3.selectAll(".tab__item")
                .on("click", function() {

                    $('.inactive').removeClass('inactive')
                    $('.active').addClass('inactive')
                    $('.active').removeClass('active')
                    $(this).addClass('active')

                    // d3.select(".datapoint").remove();

                    


                    


                    // var data = $('.tab__item--left').hasClass('active') ? foodgroups : dataset;


                      d3.csv("foodgroups.csv", function(error, data) {
                          var foodgroups = data.map(function(d) { return [ +d["gal/calorie"], +d["gal/lb"], +d["lb/capita"], d["name"], d["group"] ]; });
                        
                          var data = $('.tab__item--left').hasClass('active') ? foodgroups : dataset;
                    

                     var tip = d3.tip()
                      .attr('class', 'd3-tip')
                      .offset([-10, 0])
                      .html(function(d) {
                        return '<div class="tooltip-title">' + d[3] + "</div>" + 
                               '<img class="tooltip-img" width="50" src="http://pngimg.com/upload/small/apple_PNG12436.png">' +
                               '<div class="tooltip-metric"><span class="tooltip-metric__name">Gallons per calorie</span><span class="tooltip-metric__value">' + round(d[0]) +'</span></div>' +
                               '<div class="tooltip-metric"><span class="tooltip-metric__name">Gallons per pound</span><span class="tooltip-metric__value">' + round(d[1]) +'</span></div>' +
                               '<div class="tooltip-metric"><span class="tooltip-metric__name">Pounds per person</span><span class="tooltip-metric__value">' + round(d[2]) +'</span></div>' +
                               '<div class="triangle"></div>';
                      })

                    xScale = d3.scale.linear()
                                    .domain([0, d3.max(data, function(d) {return d[0]; })]) 
                                    .range([0, width]);

                    yScale = d3.scale.linear()
                                    .domain([0, d3.max(data, function(d) {return d[1]; })]) 
                                    .range([height, 0]);

                    rScale = d3.scale.linear()
                                     .domain([0, d3.max(data, function(d) {return d[2]; })]) 
                                     .range([0, 1500])
// 
                    xAxis  = d3.svg.axis()
                                   .scale(xScale)
                                   .orient("bottom")
                                   .ticks(5)
                                   .tickSize(1)
                                   .tickPadding(15);

                    yAxis  = d3.svg.axis()
                                   .scale(yScale)
                                   .orient("left")
                                   .ticks(5)
                                   .tickSize(1)
                                   .tickPadding(15);

                    svg.call(tip);

                    var circle = svg.selectAll('.datapoint').data(data);
                    circle.exit().remove();
                    circle.enter().append("circle")
                                  .attr("height", function(d) { return height - yScale(d[1]); })
                                  .style("fill", function(d) {
                                    switch(d[4]) {
                                      case "meat":
                                        return "E99399";
                                        break;
                                      case "g":
                                        return "B6CFE8";
                                        break;
                                      case "vegetable":
                                        return "#B5DDC3";
                                        break;
                                      case "fish":
                                        return "#EAE9A1";
                                        break;
                                      case "grain":
                                        return "#C3A1EA";
                                        break;
                                      case "nut":
                                        return "#E87F7F";
                                        break;
                                      case "dairy":
                                        return "#92BBE8";
                                        break;
                                      default:
                                        return "#ccc";
                                    }
                                  }) 
                                  .on('mouseover', tip.show)
                                  .on('mouseout', tip.hide)
                                  .attr("r", 0);


                    // restore legends

                    d3.selectAll(".dairy").style("opacity", .7);
                    d3.selectAll(".meat").style("opacity", .7);
                    d3.selectAll(".fruit").style("opacity", .7);
                    d3.selectAll(".vegetable").style("opacity", .7);
                    d3.selectAll(".grain").style("opacity", .7);
                    d3.selectAll(".nut").style("opacity", .7);
                    d3.selectAll(".fish").style("opacity", .7);

                    d3.select("#meat-label").style("fill", "#E99399");
                    d3.select("#meat-label__circle").style("fill", "#E99399");
                    d3.select("#vegetable-label").style("fill", "#B5DDC3");
                    d3.select("#vegetable-label__circle").style("fill", "#B5DDC3");
                    d3.select("#fruit-label").style("fill", "#B6CFE8");
                    d3.select("#fruit-label__circle").style("fill", "#B6CFE8");
                    d3.select("#grain-label").style("fill", "#C3A1EA");
                    d3.select("#grain-label__circle").style("fill", "#C3A1EA");


                    circle.transition()
                          .duration(500)
                          .attr("cx", function(d) {
                            return xScale(d[0]);  // Circle's X
                          })
                          .attr("cy", function(d) {
                              return yScale(d[1]);  // Circle's Y
                          })
                          .attr("r", function(d) {
                            return Math.sqrt(rScale(d[2]));
                          })
                          .attr("class", function(d) {
                            return "datapoint " + d[4];
                          })
                          .attr("id", function(d) {
                            return d[4];
                          })
                          .attr("opacity", 0.7)
                          .style("fill", function(d) {
                            switch(d[4]) {
                              case "meat":
                                return "E99399";
                                break;
                              case "fruit":
                                return "B6CFE8";
                                break;
                              case "vegetable":
                                return "#B5DDC3";
                                break;
                              case "fish":
                                return "#EAE9A1";
                                break;
                              case "grain":
                                return "#C3A1EA";
                                break;
                              case "nut":
                                return "#E87F7F";
                                break;
                              case "dairy":
                                return "#92BBE8";
                                break;
                              default:
                                return "#ccc";
                            }
                          }) 
                          

                 
      

                    // Update X Axis
                    svg.selectAll(".x.axis")
                        .transition()
                        .duration(1000)
                        .call(xAxis);

                    // Update Y Axis
                    svg.selectAll(".y.axis")
                        .transition()
                        .duration(100)
                        .call(yAxis);

                })
            
        });
});

</script>
<script src="https://code.jquery.com/jquery-3.1.1.min.js"
  integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8="
  crossorigin="anonymous"></script>
</body>
</html>
